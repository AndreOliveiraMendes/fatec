{% extends "base-fluid" %}
{% from "macros/form.html" import action_buttons %}
{% block title %}
    Tela Televisor
{% endblock title %}
{% block extra_head %}
    <noscript>
        {{ refresh_page(15*intervalo/1000) }}
    </noscript>
{% endblock extra_head %}
{% block navigation %}
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand"
                   title="ir a pagina inicial"
                   href="{{ url_for('default.home') }}">
                    Sistema RLF
                    {% if user and user.perm|has_flag(FIXA) %}
                        <i class="glyphicon glyphicon-calendar"
                           title="Permissão de Reserva Fixa"></i>
                    {% endif %}
                    {% if user and user.perm|has_flag(TEMP) %}
                        <i class="glyphicon glyphicon-time"
                           title="Permissão de Reserva Temporária"></i>
                    {% endif %}
                    {% if user and user.perm|has_flag(AUDITORIO) %}
                        <i class="glyphicon glyphicon-bullhorn"
                           title="Permissão de Reserva de Auditório"></i>
                    {% endif %}
                    {% if user and user.perm|has_flag(ADMIN) %}
                        <i class="glyphicon glyphicon-fire" title="Permissão de Administrador"></i>
                    {% endif %}
                </a>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li class="navbar-text nav-centered">
                    <span>{{ hoje|datainfo(DATA_COMPLETA+HORA+SEMANA_COMPLETA) }}</span>
                    <div class="circle-icon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
{% endblock navigation %}
{% block content %}
    <div id="grupolocal"
         role="region"
         aria-label="Grupo de Laboratórios"
         aria-live="polite">
        <div class="carousel-inner">
            {% for lab_group in locais %}
                <div class="slide{% if loop.index0 == 0 %} active{% endif %}"
                     role="group"
                     aria-hidden="{{ 'false' if loop.index0 == 0 else 'true' }}">
                    <table class="table table-striped table-bordered tabela-reserva-tv">
                        <thead>
                            <tr>
                                <th class="fixa">Horário:</th>
                                {% for lab in lab_group %}<th>{{ lab.nome_local.upper().replace('LABORATORIO', 'LAB') }}</th>{% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for aula in aulas %}
                                <tr>
                                    <td class="fixa text-{{ loop.cycle('info', 'success') }}">
                                        <span class="glyphicon glyphicon-time"></span> {{ aula[1].horario_inicio|hora }} - {{ aula[1].horario_fim|hora }}
                                    </td>
                                    {% for lab in lab_group %}<td>{{ get_reserva(lab.id_local, aula[0].id_aula_ativa, hoje, true) }}</td>{% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock content %}
{% block extra_script %}
    <script>
        // slide automático para cada grupo de laboratórios
        document.addEventListener('DOMContentLoaded', function () {
            const slides = document.querySelectorAll('#grupolocal .slide');
            let current = 0;
            let ciclos = 0;
            const intervalo = {{ intervalo|default(5000) }};  // ms

            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === index);
                    slide.setAttribute('aria-hidden', i !== index);
                });
            }

            setInterval(() => {
                current = (current + 1) % slides.length;
                showSlide(current);
                if (current === 0) {
                    ciclos++;
                    // Atualiza a página a cada 3 ciclos
                    if (ciclos % 3 === 0) {
                        window.location.reload();
                    }
                }
            }, intervalo);
        });
    </script>
{% endblock extra_script %}
{% block footer %}
    <div>
        <strong>Legenda dos ícones:</strong>
        <ul class="list-inline">
            <li>
                <span class="reserva-icon text-muted">
                    <i class="glyphicon glyphicon-user base-icon"></i>
                </span>
                — indefinido
            </li>
            <li>
                <span class="reserva-icon text-danger">
                    <i class="glyphicon glyphicon-user base-icon"></i>
                    <i class="glyphicon glyphicon-remove icon-contrast overlay-icon"></i>
                </span>
                — não pegou a chave
            </li>
            <li>
                <span class="reserva-icon text-success">
                    <i class="glyphicon glyphicon-user base-icon"></i>
                    <i class="glyphicon glyphicon-ok icon-contrast overlay-icon"></i>
                </span>
                — está em sala
            </li>
            <li>
                <span class="reserva-icon text-primary">
                    <i class="glyphicon glyphicon-user base-icon"></i>
                    <i class="glyphicon glyphicon-log-out icon-contrast overlay-icon"></i>
                </span>
                — reserva efetuada
            </li>
        </ul>
    </div>
{% endblock footer %}
