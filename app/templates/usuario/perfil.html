{% extends "base-fixed" %}
{% block title %}
    Perfil
{% endblock title %}
{% block content %}
    <!-- Painel do Usuário -->
    <div class="panel panel-primary">
        <div class="panel-heading">
            <strong>Usuário</strong>
        </div>
        <div class="panel-body">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="id_usuario" class="col-sm-2 control-label">Código do Usuário:</label>
                    <div class="col-sm-10">
                        <input type="number"
                               class="form-control"
                               id="id_usuario"
                               value="{{ user.id_usuario }}"
                               disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label for="tipo_usuario" class="col-sm-2 control-label">Tipo de usuário:</label>
                    <div class="col-sm-10">
                        <input type="text"
                               maxlength="50"
                               class="form-control"
                               id="tipo_usuario"
                               value="{{ user.tipo_pessoa }}"
                               disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label for="situacao_pessoa" class="col-sm-2 control-label">Situação:</label>
                    <div class="col-sm-10">
                        <input type="text"
                               maxlength="50"
                               class="form-control"
                               id="situacao_pessoa"
                               value="{{ user.situacao_pessoa }}"
                               disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label for="grupo_pessoa" class="col-sm-2 control-label">Grupo:</label>
                    <div class="col-sm-10">
                        <input type="text"
                               maxlength="50"
                               class="form-control"
                               id="grupo_pessoa"
                               value="{{ user.grupo_pessoa }}"
                               disabled>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Painel de Informações Pessoais -->
    <div class="panel panel-primary">
        <div class="panel-heading">
            <strong>Informações Pessoais</strong>
        </div>
        <div class="panel-body text-left">
            <div class="row">
                <div class="col-sm-6">
                    <label for="codigo_pessoa">Código da Pessoa:</label>
                    <input type="number"
                           id="codigo_pessoa"
                           class="form-control"
                           value="{{ user.pessoa.id_pessoa }}"
                           disabled>
                </div>
                <div class="col-sm-6">
                    <label for="nome">Nome:</label>
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                        <input type="text"
                               maxlength="100"
                               id="nome"
                               class="form-control"
                               value="{{ user.pessoa.nome_pessoa }}"
                               disabled>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-12">
                    <label for="email">E-Mail:</label>
                    <div class="input-group">
                        <span class="input-group-addon">@</span>
                        <input type="email"
                               id="email"
                               class="form-control"
                               value="{{ user.pessoa.email_pessoa }}"
                               disabled>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Painel da Grade com Busca -->
    <div class="panel panel-primary">
        <div class="panel-heading">
            <strong>Grade</strong>
        </div>
        <div class="panel-body">
            {% if erro_grade %}
                <div class="alert alert-warning">Não foi possível carregar sua grade no momento.</div>
            {% elif not grade %}
                <div class="alert alert-info">Nenhuma disciplina vinculada ao seu perfil.</div>
            {% else %}
                <!-- grade -->
                <div class="table-responsive">
                    <table id="gradeTable" class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Professor</th>
                                <th>Período</th>
                                <th>Ciclo</th>
                                <th>Curso</th>
                                <th>Disciplina</th>
                            </tr>
                            <!-- Filtros por coluna -->
                            <tr id="filters">
                                <th>
                                    <input type="text"
                                           class="form-control input-sm filtro-coluna"
                                           data-col="0"
                                           placeholder="Filtrar Professor">
                                </th>
                                <th>
                                    <input type="text"
                                           class="form-control input-sm filtro-coluna"
                                           data-col="1"
                                           placeholder="Filtrar Período">
                                </th>
                                <th>
                                    <input type="text"
                                           class="form-control input-sm filtro-coluna"
                                           data-col="2"
                                           placeholder="Filtrar Ciclo">
                                </th>
                                <th>
                                    <input type="text"
                                           class="form-control input-sm filtro-coluna"
                                           data-col="3"
                                           placeholder="Filtrar Curso">
                                </th>
                                <th>
                                    <input type="text"
                                           class="form-control input-sm filtro-coluna"
                                           data-col="4"
                                           placeholder="Filtrar Disciplina">
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in grade %}
                                {% set classe_periodo = "" %}
                                {% if item.periodo == 'M' %}
                                    {% set classe_periodo = "grade-manha" %}
                                {% elif item.periodo == 'T' %}
                                    {% set classe_periodo = "grade-vespertino" %}
                                {% elif item.periodo == 'N' %}
                                    {% set classe_periodo = "grade-noturno" %}
                                {% endif %}
                                <tr class="{{ classe_periodo }}">
                                    <td>{{ item.professor }}</td>
                                    <td>{{ item.periodo }}</td>
                                    <td>{{ item.ciclo }}</td>
                                    <td>{{ item.curso_nome }}</td>
                                    <td>{{ item.disciplina_nome }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- JS do filtro -->
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        const filtros = document.querySelectorAll(".filtro-coluna");
                        const tabela = document.querySelector("#gradeTable tbody");
                        const linhas = tabela.getElementsByTagName("tr");

                        filtros.forEach(function(input) {
                            input.addEventListener("keyup", function() {
                                const valoresFiltro = Array.from(filtros).map(f => f.value.toLowerCase());

                                for (let i = 0; i < linhas.length; i++) {
                                    let mostrar = true;
                                    const colunas = linhas[i].getElementsByTagName("td");

                                    for (let j = 0; j < valoresFiltro.length; j++) {
                                        if (valoresFiltro[j] && !colunas[j].textContent.toLowerCase().includes(valoresFiltro[j])) {
                                            mostrar = false;
                                            break;
                                        }
                                    }

                                    linhas[i].style.display = mostrar ? "" : "none";
                                }
                            });
                        });
                    });
                </script>
            {% endif %}
        </div>
        <div class="panel-footer">
            <div class="table-responsive">
                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Período</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="grade-manha">
                            <td>M</td>
                            <td>Matutino / Manhã</td>
                        </tr>
                        <tr class="grade-vespertino">
                            <td>T</td>
                            <td>Vespertino / Tarde</td>
                        </tr>
                        <tr class="grade-noturno">
                            <td>N</td>
                            <td>Noturno / Noite</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock content %}
{% block extra_css %}
    <style>
        /* Cores leves para cada período */
        .grade-manha {
            background-color: #fff8dc; /* bege claro */
        }
        .grade-vespertino {
            background-color: #d0f0c0; /* verde claro */
        }
        .grade-noturno {
            background-color: #cce5ff; /* azul claro */
        }

        /* Mantém o hover da tabela do Bootstrap */
        #gradeTable tbody tr:hover {
            background-color: #f5f5f5 !important;
        }

    </style>
{% endblock extra_css %}
