{% extends "database/base_crude" %}

{% block title %}Usuarios{% endblock %}

{% block content_head %}
{{ generate_head(url_for("gerenciar_usuarios"), acao) }}
{% endblock %}
{% set disable_editar=False %}
{% set disable_excluir=False %}

{% block abertura %}
<h3>Gerenciamento da Tabela <strong>Usuarios</strong></h3>
<p>A tabela <code>usuarios</code> possui os seguintes campos:</p>

<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr class="info">
            <th>Campo</th>
            <th>Descrição</th>
        </tr>
    </thead>
    <tbody>
        {% for campo, descricao in [
        ('id_usuario', 'Identificador do usuario'),
        ('id_pessoa', 'Identificador do usuario'),
        ('tipo_usuario', 'tipo de conta'),
        ('situacao_pessoa', 'situacao da conta (ATIVO/DESATIVO)'),
        ('grupo_pessoa', 'grupo ao qual o usuario pertence')
        ] %}
        <tr>
            <td><code>{{ campo }}</code></td>
            <td>{{ descricao }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block listar %}
<h3>Lista de Usuarios</h3>
<table class="table table-bordered table-striped table-hover">
    <thead>
        <tr class="info">
            <th>Id Usuario</th>
            <th>Id Pessoa</th>
            <th>Tipo Pessoa</th>
            <th>Situacao Pessoa</th>
            <th>Grupo Pessoa</th>
            {% if not disable_editar or not disable_excluir %}<th>Ação</th>{% endif %}
        </tr>
    </thead>
    <tbody>
        {% for u in usuarios %}
        <tr>
            <td>{{ u.id_usuario }}</td>
            <td>{{ u.id_pessoa }}</td>
            <td>{{ u.tipo_pessoa }}</td>
            <td>{{ u.situacao_pessoa }}</td>
            <td>{{ u.grupo_pessoa }}</td>
            {% if not disable_editar or not disable_excluir %}
            <td>
                <form method="post" class="form-inline">
                    <input type="hidden" name="bloco" value="1">
                    <input type="hidden" name="id_usuario" value="{{ u.id_usuario }}">
                    <div class="btn-group">
                        {% if not disable_editar %}
                        <button type="submit" name="acao" value="editar" class="btn btn-warning btn-sm" title="Editar">
                            <i class="glyphicon glyphicon-pencil"></i>
                        </button>
                        {% endif %}
                        {% if u.id_usuario != userid and not disable_excluir %}
                        <button type="submit" name="acao" value="excluir" class="btn btn-danger btn-sm" title="Excluir">
                            <i class="glyphicon glyphicon-trash"></i>
                        </button>
                        {% endif %}
                    </div>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{{ paginacao(pagination, acao, bloco) }}
{% endblock %}

{% block procurar %}
{% if bloco == 0 %}
<h3>Procurar Usuario</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    <div class="form-group">
        <label for="codigo">Codigo Usuario:</label>
        <input type="number" class="form-control" name="id_usuario" id="id_usuario" placeholder="Digite o id">
    </div>

    <div class="form-group">
        <label for="codigo">Codigo Pessoa:</label>
        <input type="number" class="form-control" name="id_pessoa" id="id_pessoa" placeholder="Digite o id">
    </div>

    <div class="form-group">
        <label for="tipo_pessoa">Tipo:</label>
        <input type="text" id="tipo_pessoa" name="tipo_pessoa" list="lista_tipo_pessoa" class="form-control">
        <datalist id="lista_tipo_pessoa">
            <option value="FUNCIONARIO">
            <option value="EXTERNO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="situacao_pessoa">Situação:</label>
        <input type="text" id="situacao_pessoa" name="situacao_pessoa" list="lista_situacao_pessoa" class="form-control">
        <datalist id="lista_situacao_pessoa">
            <option value="ATIVO">
            <option value="INATIVO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="grupo_pessoa">Grupo:</label>
        <input type="text" id="grupo_pessoa" name="grupo_pessoa" list="lista_grupo_pessoa" class="form-control">
        <datalist id="lista_grupo_pessoa">
                <option value="ADMINISTRADOR">ADMINISTRADOR</option>
                <option value="SECRETARIA">SECRETARIA</option>
                <option value="DOCENTE">DOCENTE</option>
                <option value="REDE">REDE</option>
                <option value="BIBLIOTECA">BIBLIOTECA</option>
                <option value="CONVIDADO">CONVIDADO</option>
        </datalist>
    </div>

    {{ action_buttons('procurar', 1, False, 0)}}
</form>
{% elif bloco == 1 %}
{% if usuarios %}
<h3>Lista de Usuarios</h3>
<table class="table table-bordered table-striped table-hover">
    <thead>
        <tr class="info">
            <th>Id Usuario</th>
            <th>Id Pessoa</th>
            <th>Tipo Pessoa</th>
            <th>Situacao Pessoa</th>
            <th>Grupo Pessoa</th>
            {% if not disable_editar or not disable_excluir %}<th>Ação</th>{% endif %}
        </tr>
    </thead>
    <tbody>
        {% for u in usuarios %}
        <tr>
            <td>{{ u.id_usuario }}</td>
            <td>{{ u.id_pessoa }}</td>
            <td>{{ u.tipo_pessoa }}</td>
            <td>{{ u.situacao_pessoa }}</td>
            <td>{{ u.grupo_pessoa }}</td>
            {% if not disable_editar or not disable_excluir %}
            <td>
                <form method="post" class="form-inline">
                    <input type="hidden" name="bloco" value="1">
                    <input type="hidden" name="id_usuario" value="{{ u.id_usuario }}">
                    <div class="btn-group">
                        {% if not disable_editar %}
                        <button type="submit" name="acao" value="editar" class="btn btn-warning btn-sm" title="Editar">
                            <i class="glyphicon glyphicon-pencil"></i>
                        </button>
                        {% endif %}
                        {% if u.id_usuario != userid and not disable_excluir %}
                        <button type="submit" name="acao" value="excluir" class="btn btn-danger btn-sm" title="Excluir">
                            <i class="glyphicon glyphicon-trash"></i>
                        </button>
                        {% endif %}
                    </div>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{{ paginacao_header(pagination, acao, bloco) }}
{{ manter_parametros(query_params) }}
{{ paginacao_button(pagination, acao, bloco) }}
{{ paginacao_footer(pagination, acao, bloco) }}
{% else %}
<div class="alert alert-warning">
    Nenhum resultado encontrado.
</div>
{% endif %}
{% endif %}
{% endblock %}

{% block inserir %}
<h3>Inserir Usuarios</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    {{ gerar_select("pessoa", "Selecione a Pessoa", pessoas, "id_pessoa", "nome_pessoa") }}

    <div class="form-group">
        <label for="tipo_pessoa">Tipo:</label>
        <input type="text" id="tipo_pessoa" name="tipo_pessoa" list="lista_tipo_pessoa" class="form-control">
        <datalist id="lista_tipo_pessoa">
            <option value="FUNCIONARIO">
            <option value="EXTERNO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="situacao_pessoa">Situação:</label>
        <input type="text" id="situacao_pessoa" name="situacao_pessoa" list="lista_situacao_pessoa" class="form-control">
        <datalist id="lista_situacao_pessoa">
            <option value="ATIVO">
            <option value="INATIVO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="grupo_pessoa">Grupo:</label>
        <input type="text" id="grupo_pessoa" name="grupo_pessoa" list="lista_grupo_pessoa" class="form-control">
        <datalist id="lista_grupo_pessoa">
            <option value="ADMINISTRADOR">ADMINISTRADOR</option>
            <option value="SECRETARIA">SECRETARIA</option>
            <option value="DOCENTE">DOCENTE</option>
            <option value="REDE">REDE</option>
            <option value="BIBLIOTECA">BIBLIOTECA</option>
            <option value="CONVIDADO">CONVIDADO</option>
        </datalist>
    </div>

    {{ action_buttons('inserir', 1, False, 0)}}
</form>
{% endblock %}

{% block editar %}
{% if bloco == 0 %}
<h3>Editar Usuarios</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    {{ gerar_select("id_usuario", "Selecione o usuario", results, "id_usuario", "nome_pessoa") }}

    {{ action_buttons('editar', 1, False, 0)}}
</form>
{% elif bloco == 1 %}
<h3>Editar Usuario</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    <div class="form-group">
        <label for="id_usuario">ID Usuario:</label>
        <input type="number" maxlength="100" class="form-control" name="id_usuario" id="id_usuario"
            value="{{ usuario.id_usuario }}" readonly required>
    </div>

    {{ gerar_select("pessoa", "Selecione a Pessoa", pessoas, "id_pessoa", "nome_pessoa", selected=usuario.id_pessoa) }}

    <div class="form-group">
        <label for="tipo_pessoa">Tipo:</label>
        <input type="text" id="tipo_pessoa" name="tipo_pessoa" list="lista_tipo_pessoa" class="form-control" value="{{ usuario.tipo_pessoa }}">
        <datalist id="lista_tipo_pessoa">
            <option value="FUNCIONARIO">
            <option value="EXTERNO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="situacao_pessoa">Situação:</label>
        <input type="text" id="situacao_pessoa" name="situacao_pessoa" list="lista_situacao_pessoa" class="form-control" value="{{ usuario.situacao_pessoa }}">
        <datalist id="lista_situacao_pessoa">
            <option value="ATIVO">
            <option value="INATIVO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="grupo_pessoa">Grupo:</label>
        <input type="text" id="grupo_pessoa" name="grupo_pessoa" list="lista_grupo_pessoa" class="form-control" value="{{ usuario.grupo_pessoa }}">
        <datalist id="lista_grupo_pessoa">
            <option value="ADMINISTRADOR">ADMINISTRADOR</option>
            <option value="SECRETARIA">SECRETARIA</option>
            <option value="DOCENTE">DOCENTE</option>
            <option value="REDE">REDE</option>
            <option value="BIBLIOTECA">BIBLIOTECA</option>
            <option value="CONVIDADO">CONVIDADO</option>
        </datalist>
    </div>

    {{ action_buttons('editar', 2, True, 0) }}
</form>
{% endif %}
{% endblock %}

{% block excluir %}
{% if bloco == 0 %}
<h3>Excluir Usuarios</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    {{ gerar_select("id_usuario", "Selecione o usuario", results, "id_usuario", "nome_pessoa") }}

    {{ action_buttons('excluir', 1, False, 0)}}
</form>
{% elif bloco == 1 %}
<h3>Excluir Usuario</h3>
<form class="form-group" role="form" action="{{ url_for('gerenciar_usuarios') }}" method="post">
    <input type="hidden" name="acao" value="{{ acao }}">

    <div class="form-group">
        <label for="id_usuario">ID Usuario:</label>
        <input type="number" maxlength="100" class="form-control" name="id_usuario" id="id_usuario"
            value="{{ usuario.id_usuario }}" readonly required>
    </div>

    {{ gerar_select("pessoa", "Selecione a Pessoa", pessoas, "id_pessoa", "nome_pessoa", selected=usuario.id_pessoa, extra="disabled") }}

    <div class="form-group">
        <label for="tipo_pessoa">Tipo:</label>
        <input type="text" id="tipo_pessoa" name="tipo_pessoa" list="lista_tipo_pessoa" class="form-control" value="{{ usuario.tipo_pessoa }}" disabled>
        <datalist id="lista_tipo_pessoa">
            <option value="FUNCIONARIO">
            <option value="EXTERNO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="situacao_pessoa">Situação:</label>
        <input type="text" id="situacao_pessoa" name="situacao_pessoa" list="lista_situacao_pessoa" class="form-control" value="{{ usuario.situacao_pessoa }}" disabled>
        <datalist id="lista_situacao_pessoa">
            <option value="ATIVO">
            <option value="INATIVO">
        </datalist>
    </div>

    <div class="form-group">
        <label for="grupo_pessoa">Grupo:</label>
        <input type="text" id="grupo_pessoa" name="grupo_pessoa" list="lista_grupo_pessoa" class="form-control" value="{{ usuario.grupo_pessoa }}" disabled>
        <datalist id="lista_grupo_pessoa">
            <option value="ADMINISTRADOR">ADMINISTRADOR</option>
            <option value="SECRETARIA">SECRETARIA</option>
            <option value="DOCENTE">DOCENTE</option>
            <option value="REDE">REDE</option>
            <option value="BIBLIOTECA">BIBLIOTECA</option>
            <option value="CONVIDADO">CONVIDADO</option>
        </datalist>
    </div>

    {{ action_buttons('excluir', 2, True, 0, False) }}
</form>
{% endif %}
{% endblock %}